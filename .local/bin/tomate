#!/bin/bash

timer=/tmp/tomate
pomodoro=1500
time_set=$(cat $timer)

start() {
  date +"%s" > $timer
}

stop() {
  echo "" > $timer
}

case $1 in
  toggle)
    if [[ $time_set = "" ]]; then
      start
    else
      stop
    fi
    ;;
  start)
    start
    ;;

  get-time)
    if [[ $time_set = "" ]]; then
      echo "{\"text\": \"00:00\"}"
    else
      seconds_passed=$(echo "$(date +"%s")" - $time_set | bc)
      echo "{\"text\": \"$(date -d @$seconds_passed +"%M:%S")\"}"
      if [[ $seconds_passed -gt $pomodoro ]]; then
        notify-send "üçÖ Tomate" "      Time is up, take a break!" -u critical
      fi
    fi
    ;;

  stop)
    stop
    ;;

esac
