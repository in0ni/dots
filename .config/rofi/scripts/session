#!/usr/bin/env bash
icon=
title=Session

if [[ $ROFI_RETV == 1 ]]; then
  echo -en "\0prompt\x1f$@\n"

  case $ROFI_INFO in
    "quit")
      exit 0
      ;;
    "power_off_confirm")
      systemctl poweroff
      exit 0
      ;;
    "suspend_confirm")
      systemctl suspend
      exit 0
      ;;
    "hibernate_confirm")
      systemctl hibernate
      exit 0
      ;;
    "reboot_confirm")
      systemctl reboot
      exit 0
      ;;
    "logout_confirm")
      hyprctl dispatch exit
      systemctl --user stop sway-session.target
      exit 0
      ;;
  esac

  nodes=$(swaymsg -t get_tree | jq '.nodes[] | .nodes[] | .nodes[] | .id' | wc -l)
  floating_nodes=$(swaymsg -t get_tree | jq '.nodes[] | .nodes[] | .floating_nodes[] | .id' | wc -l)

  if [[ $ROFI_INFO != "suspend" && $ROFI_INFO != "hibernate" ]]; then
    if [[ $nodes -gt 0 || $floating_nodes -gt 0 ]]; then
      echo -en "\0message\x1f  Are you sure? There are <b>open windows</b> ($nodes tiled, $floating_nodes floating)\n"
      echo -en "\0urgent\x1f1\n"
      echo -en "Plese confirm.\0nonselectable\x1ftrue\n"
    fi
  fi

  echo -en "Yes\0info\x1f${ROFI_INFO}_confirm\n"
  echo -en "No\0info\x1fquit\n"
  # echo -en "$ROFI_INFO"
else
  echo -en "\0prompt\x1f$icon $title\n"
  echo -en "   Power Off\0meta\x1fshutdown\x1finfo\x1fpower_off\n"
  echo -en "   Suspend\0meta\x1fsuspend\x1finfo\x1fsuspend\n"
  echo -en "   Hibernate\0meta\x1fhibernate\x1finfo\x1fhibernate\n"
  echo -en "   Reboot\0meta\x1frestart\x1finfo\x1freboot\n"
  echo -en "   Logout\0info\x1flogout\n"
fi
